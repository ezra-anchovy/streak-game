<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="STREAK" />
  <meta name="theme-color" content="#ff3e6c" />
  <meta name="description" content="Predict patterns, build streaks, win big. A premium pattern prediction game." />
  
  <!-- Open Graph / Social Sharing -->
  <meta property="og:title" content="STREAK - Pattern Prediction" />
  <meta property="og:description" content="Can you predict the pattern? Build streaks and win big!" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://via.placeholder.com/1200x630/080a1a/ff3e6c?text=ðŸ”¥+STREAK" />
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23080a1a' width='100' height='100' rx='20'/><text x='50' y='65' text-anchor='middle' font-size='50'>ðŸ”¥</text></svg>" />
  
  <title>STREAK - Pattern Prediction</title>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-1: #080a1a;
      --bg-2: #111831;
      --bg-3: #1b1f42;
      --accent: #ff3e6c;
      --accent-2: #2de1ff;
      --accent-3: #63ff96;
      --accent-4: #ffc14a;
      --text: #f8f9ff;
      --muted: #c8cbe6;
      --card: rgba(255, 255, 255, 0.06);
      --border: rgba(255, 255, 255, 0.12);
      --shadow: 0 20px 50px rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; }
    
    /* Premium animations */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 62, 108, 0.3); }
      50% { box-shadow: 0 0 40px rgba(255, 62, 108, 0.6); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes rotateLight {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: "Montserrat", system-ui, sans-serif;
      background: radial-gradient(1200px 800px at 10% 10%, #2b2f66 0%, transparent 60%),
                  radial-gradient(800px 600px at 90% 20%, #17605e 0%, transparent 55%),
                  linear-gradient(135deg, var(--bg-1), var(--bg-2) 50%, var(--bg-3));
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    
    /* Cinematic grain overlay for premium texture */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 999;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    }

    .game {
      width: min(1100px, 100%);
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      box-shadow: 
        var(--shadow),
        0 0 80px rgba(255, 62, 108, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(16px);
      padding: clamp(20px, 3vw, 32px);
      position: relative;
      overflow: hidden;
      animation: float 6s ease-in-out infinite;
    }
    
    /* Premium rotating light border effect */
    .game::before {
      content: "";
      position: absolute;
      inset: -2px;
      z-index: -1;
      background: conic-gradient(
        from 0deg at 50% 50%,
        transparent 0%,
        var(--accent) 15%,
        transparent 30%,
        var(--accent-2) 45%,
        transparent 60%,
        var(--accent-3) 75%,
        transparent 90%
      );
      filter: blur(20px);
      animation: rotateLight 8s linear infinite;
      border-radius: inherit;
      opacity: 0.4;
    }

    .game::before {
      content: "";
      position: absolute;
      inset: -40% -20% auto auto;
      width: 320px;
      height: 320px;
      background: radial-gradient(circle, rgba(255, 62, 108, 0.4), transparent 60%);
      filter: blur(10px);
      z-index: 0;
    }

    .game::after {
      content: "";
      position: absolute;
      inset: auto auto -40% -20%;
      width: 360px;
      height: 360px;
      background: radial-gradient(circle, rgba(45, 225, 255, 0.35), transparent 60%);
      filter: blur(12px);
      z-index: 0;
    }

    header {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column; /* Stack elements vertically by default */
      gap: 16px; /* Reduced gap */
      align-items: center; /* Center items for a cleaner look */
      justify-content: space-between;
      margin-bottom: 22px;
    }

    .main-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      justify-content: center;
      width: 100%; /* Take full width */
    }

    .title {
      font-family: "Baloo 2", cursive;
      font-size: clamp(28px, 4vw, 44px);
      letter-spacing: 2px;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px; /* Space between title and nav */
    }

    .title span {
      color: var(--accent-2);
      text-shadow: 0 0 18px rgba(73, 211, 255, 0.6);
    }

    /* Existing .stats is replaced by .main-nav, so remove .stats styling */

    .stat-card {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 10px 16px;
      min-width: 100px; /* Adjusted min-width for compactness */
      display: grid;
      gap: 4px;
      text-align: center; /* Center text in stat cards */
    }

    .stat-label {
      font-size: 11px; /* Slightly smaller font */
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--muted);
    }

    .stat-value {
      font-size: 18px; /* Slightly smaller font */
      font-weight: 600;
    }

    main {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 0.8fr) minmax(0, 0.7fr); /* Added column for leaderboard */
      gap: 24px;
    }

    @media (max-width: 1100px) {
      main { grid-template-columns: minmax(0, 1fr) minmax(0, 0.9fr); }
      .leaderboard-panel { display: none; } /* Hide leaderboard on medium screens */
    }

    @media (max-width: 900px) {
      main { grid-template-columns: 1fr; }
      .leaderboard-panel { display: block; } /* Show leaderboard again on small screens, stack vertically */
    }

    @media (max-width: 600px) {
      .main-nav {
        flex-direction: column; /* Stack nav items vertically */
        align-items: stretch;
      }
      .stat-card { min-width: unset; }
    }

    .panel {
      background: rgba(10, 12, 24, 0.45);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: clamp(16px, 2.2vw, 22px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .panel h2 {
      margin: 0 0 12px;
      font-family: "Baloo 2", cursive;
      font-size: 22px;
      letter-spacing: 1px;
      color: var(--accent-3); /* Improved contrast */
    }

    /* Leaderboard Styles */
    .leaderboard-list {
      display: grid;
      gap: 8px;
      margin-top: 15px;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      font-size: 14px;
    }

    .leaderboard-rank {
      font-weight: 700;
      color: var(--accent-4);
      width: 30px;
      text-align: left;
    }

    .leaderboard-name {
      flex-grow: 1;
      text-align: left;
      color: var(--text);
    }

    .leaderboard-score {
      font-weight: 600;
      color: var(--accent-2);
      text-align: right;
    }

    .sequence {
      display: flex;
      gap: clamp(10px, 2vw, 18px);
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      padding: 16px 0 6px;
    }

    .slot {
      width: clamp(58px, 8vw, 88px);
      height: clamp(58px, 8vw, 88px);
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      display: grid;
      place-items: center;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .slot::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25), transparent 60%);
      opacity: 0.4;
    }

    .slot.mystery {
      background: rgba(255, 255, 255, 0.12);
      border-style: dashed;
    }

    .slot.mystery span {
      font-size: 24px;
      color: var(--muted);
    }

    .shape {
      width: 52%;
      height: 52%;
      transition: transform 0.3s ease;
    }

    .circle {
      border-radius: 50%;
      background: currentColor;
    }

    .square {
      background: currentColor;
    }

    .triangle {
      width: 0;
      height: 0;
      border-left: 26px solid transparent;
      border-right: 26px solid transparent;
      border-bottom: 46px solid currentColor;
      transform: translateY(6px);
    }

    .legend {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
    }

    .bets, .choices {
      display: grid;
      gap: 12px;
      margin-top: 12px;
    }

    .bets {
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    }

    .choices {
      grid-template-columns: repeat(auto-fit, minmax(96px, 1fr));
    }

    .btn {
      border: 1px solid transparent;
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      font-family: "Montserrat", sans-serif;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.2s ease, border 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
      min-height: 50px;
      position: relative;
    }

    .btn:hover { transform: translateY(-2px); }

    .btn.selected {
      border-color: var(--accent-2);
      background: rgba(73, 211, 255, 0.2);
      box-shadow: 0 0 18px rgba(73, 211, 255, 0.3);
    }

    .btn.bet {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn.primary {
      background: linear-gradient(120deg, var(--accent), #ff9b5e);
      border: none;
      color: #1b1020;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
    }
    
    .btn.primary::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 200%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 3s infinite;
    }
    
    .btn.primary:hover {
      animation: pulse-glow 1.5s infinite;
      transform: translateY(-2px) scale(1.02);
    }

    .btn.primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn .hint {
      position: absolute;
      right: 8px;
      bottom: 6px;
      font-size: 10px;
      letter-spacing: 1px;
      color: rgba(255, 255, 255, 0.65);
      text-transform: uppercase;
      pointer-events: none;
    }

    .btn.toggle {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.18);
    }

    .btn.toggle.active {
      background: rgba(99, 255, 150, 0.18);
      border-color: rgba(99, 255, 150, 0.6);
      box-shadow: 0 0 18px rgba(99, 255, 150, 0.3);
      color: #e8fff0;
    }

    .message {
      min-height: 48px;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      transition: background 0.3s ease, border 0.3s ease, color 0.3s ease;
    }

    .message strong { color: var(--text); }

    .glow {
      animation: pulse 1.1s ease-in-out infinite alternate;
    }

    @keyframes pulse {
      from { box-shadow: 0 0 0 rgba(123, 255, 143, 0.3); }
      to { box-shadow: 0 0 20px rgba(123, 255, 143, 0.6); }
    }

    .footer-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 12px;
    }

    .tagline {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      margin-top: 10px;
    }

    .stat-card.timer.danger .stat-value {
      color: var(--accent-4);
      text-shadow: 0 0 10px rgba(255, 193, 74, 0.7);
    }

    .stat-card.best .stat-value {
      color: var(--accent-3);
      text-shadow: 0 0 12px rgba(123, 255, 143, 0.5);
    }

    .bet-preview {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px dashed rgba(255, 255, 255, 0.18);
      color: var(--muted);
      font-size: 13px;
      text-align: center;
      min-height: 40px;
      display: grid;
      place-items: center;
      transition: color 0.2s ease, border 0.2s ease;
    }

    .bet-preview.active {
      color: var(--text);
      border-color: rgba(255, 182, 94, 0.6);
      box-shadow: 0 0 18px rgba(255, 182, 94, 0.2);
    }

    .bet-preview.risky {
      border-color: rgba(255, 62, 108, 0.7);
      box-shadow: 0 0 18px rgba(255, 62, 108, 0.3);
      color: var(--accent);
      animation: pulse-warning 1s ease-in-out infinite;
    }

    @keyframes pulse-warning {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .game.win {
      animation: win-pop 0.6s ease;
    }

    @keyframes win-pop {
      0% { transform: scale(1); }
      40% { transform: scale(1.015); }
      100% { transform: scale(1); }
    }

    .game.best-beat {
      animation: best-beat 1.3s ease;
    }

    @keyframes best-beat {
      0% { box-shadow: 0 0 0 rgba(255, 214, 94, 0.2); }
      40% { box-shadow: 0 0 40px rgba(255, 214, 94, 0.75); }
      100% { box-shadow: 0 0 0 rgba(255, 214, 94, 0.2); }
    }

    .stat-card.best.new-record {
      border-color: rgba(255, 214, 94, 0.8);
      box-shadow: 0 0 18px rgba(255, 214, 94, 0.5);
      background: linear-gradient(135deg, rgba(255, 214, 94, 0.2), rgba(255, 255, 255, 0.08));
    }

    #confetti {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 20;
    }

    #fx-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 10;
    }

    .float-points {
      position: absolute;
      font-family: "Baloo 2", cursive;
      font-size: 24px;
      color: var(--accent-3);
      text-shadow: 0 0 14px rgba(123, 255, 143, 0.7);
      animation: float-up 1.3s ease forwards;
      opacity: 0;
    }

    @keyframes float-up {
      0% { transform: translate(-50%, 10px) scale(0.8); opacity: 0; }
      15% { opacity: 1; }
      100% { transform: translate(-50%, -70px) scale(1.1); opacity: 0; }
    }

    .banner-pop {
      position: absolute;
      left: 50%;
      top: 6%;
      transform: translateX(-50%);
      padding: 10px 20px;
      border-radius: 999px;
      font-family: "Baloo 2", cursive;
      font-size: 20px;
      letter-spacing: 1px;
      text-transform: uppercase;
      animation: banner-pop 1.6s ease forwards;
      opacity: 0;
      white-space: nowrap;
    }

    .banner-best {
      background: linear-gradient(120deg, #ffd65e, #ff9b5e);
      color: #2b1b0f;
      box-shadow: 0 0 20px rgba(255, 214, 94, 0.6);
    }

    .banner-milestone {
      background: linear-gradient(120deg, #7bff8f, #49d3ff);
      color: #04151f;
      box-shadow: 0 0 20px rgba(73, 211, 255, 0.5);
    }

    @keyframes banner-pop {
      0% { transform: translate(-50%, -8px) scale(0.8); opacity: 0; }
      25% { opacity: 1; }
      60% { transform: translate(-50%, 0) scale(1.05); opacity: 1; }
      100% { transform: translate(-50%, -16px) scale(0.95); opacity: 0; }
    }

    .sequence.pulse .slot {
      animation: pattern-pulse 0.9s ease-in-out infinite;
    }

    @keyframes pattern-pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 rgba(255, 193, 74, 0.2); }
      50% { transform: scale(1.04); box-shadow: 0 0 18px rgba(255, 193, 74, 0.6); }
      100% { transform: scale(1); box-shadow: 0 0 0 rgba(255, 193, 74, 0.2); }
    }

    .game.shake {
      animation: shake 0.45s ease;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-6px); }
      80% { transform: translateX(6px); }
      100% { transform: translateX(0); }
    }

    .instructions-overlay {
      position: fixed;
      inset: 0;
      background: rgba(8, 10, 26, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .instructions-overlay.hidden {
      display: none;
    }

    .instructions-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .instructions-title {
      font-family: "Baloo 2", cursive;
      font-size: 28px;
      color: var(--accent);
      margin: 0 0 16px 0;
      text-align: center;
    }

    .instructions-section {
      margin: 16px 0;
    }

    .instructions-section h3 {
      color: var(--accent-2);
      margin: 0 0 8px 0;
      font-size: 16px;
    }

    .instructions-section ul {
      margin: 0;
      padding-left: 20px;
    }

    .instructions-section li {
      margin: 6px 0;
      color: var(--muted);
    }

    .combo-indicator {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(45, 225, 255, 0.12);
      border: 1px solid rgba(45, 225, 255, 0.35);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border 0.3s ease;
    }

    .combo-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--muted);
    }

    .combo-value {
      font-family: "Baloo 2", cursive;
      font-size: 22px;
      letter-spacing: 1px;
      color: var(--accent-2);
      text-shadow: 0 0 12px rgba(45, 225, 255, 0.6);
      transition: transform 0.3s ease;
    }

    .combo-indicator.hot {
      background: rgba(255, 62, 108, 0.16);
      border-color: rgba(255, 62, 108, 0.55);
      box-shadow: 0 0 24px rgba(255, 62, 108, 0.3);
    }

    .combo-indicator.hot .combo-value {
      color: #ffd65e;
      text-shadow: 0 0 14px rgba(255, 214, 94, 0.7);
    }

    .combo-bar {
      flex: 1;
      height: 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      overflow: hidden;
      position: relative;
      margin-left: 8px;
    }

    .combo-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(120deg, var(--accent-2), var(--accent-3));
      transition: width 0.4s ease;
      box-shadow: 0 0 10px rgba(99, 255, 150, 0.6);
    }

    .gameover {
      position: fixed;
      inset: 0;
      background: rgba(6, 8, 20, 0.72);
      display: grid;
      place-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 30;
    }

    .gameover.active {
      opacity: 1;
      pointer-events: auto;
    }

    .gameover-card {
      background: rgba(10, 12, 24, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 22px;
      padding: 24px;
      width: min(520px, 90vw);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      text-align: center;
      display: grid;
      gap: 14px;
      transform: translateY(10px);
      transition: transform 0.3s ease;
    }

    .gameover.active .gameover-card {
      transform: translateY(0);
    }

    .gameover-title {
      font-family: "Baloo 2", cursive;
      font-size: 32px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--accent-4);
      text-shadow: 0 0 16px rgba(255, 193, 74, 0.7);
    }

    .gameover-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
    }

    .gameover-stat {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 14px;
      padding: 12px;
    }

    .gameover-stat label {
      display: block;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .gameover-stat span {
      font-size: 20px;
      font-weight: 700;
    }

    @media (max-width: 700px) {
      .btn { min-height: 58px; font-size: 14px; }
      .choices { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .bets { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .slot { width: clamp(62px, 18vw, 92px); height: clamp(62px, 18vw, 92px); }
      .combo-indicator { flex-direction: column; align-items: flex-start; }
      .combo-bar { width: 100%; margin-left: 0; }
    }
  </style>
</head>
<body>
  <div class="game">
    <div class="instructions-overlay" id="instructions-overlay">
      <div class="instructions-card">
        <h2 class="instructions-title">Welcome to STREAK âš¡</h2>
        <p>Your goal is to predict the next shape and color in the sequence before the timer runs out. Longer streaks mean bigger rewards!</p>
        <div class="instructions-section">
          <h3>How to Play:</h3>
          <ul>
            <li>Observe the sequence of 4 shapes and colors.</li>
            <li>Identify the pattern to predict the 5th item.</li>
            <li>Choose your prediction (shape + color) from the options below.</li>
            <li>Place your bet: Higher bets mean higher potential rewards/losses.</li>
            <li>Hit "Lock In Guess" before time runs out!</li>
          </ul>
        </div>
        <div class="instructions-section">
          <h3>Tips:</h3>
          <ul>
            <li>Watch the timer: Quick decisions are key!</li>
            <li>Go for a streak: Multipliers increase with every correct guess.</li>
            <li>"Double or Nothing": Available at 3+ streak for huge payouts (but risky!).</li>
          </ul>
        </div>
        <div class="instructions-section" style="background: rgba(99, 255, 150, 0.1); border-radius: 12px; padding: 12px; margin-top: 12px;">
          <h3 style="color: var(--accent-3);">ðŸ’¡ Smart Play Guide:</h3>
          <ul>
            <li><strong>Start small:</strong> Bet 10-25 until you learn the patterns.</li>
            <li><strong>Never bet more than 25% of your points</strong> in a single round.</li>
            <li><strong>Build streaks first:</strong> Low bets + high streaks = big multipliers.</li>
            <li><strong>Know when to stop:</strong> Set a goal (e.g., 500 pts) and take a break!</li>
          </ul>
        </div>
        <button id="start-game-btn" class="btn primary">Start Game</button>
      </div>
    </div>
    <header>
      <div class="title">STREAK <span>âš¡</span></div>
      <nav class="main-nav">
        <div class="stat-card">
          <div class="stat-label">Points</div>
          <div id="points" class="stat-value">200</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Streak</div>
          <div id="streak" class="stat-value">0</div>
        </div>
        <div class="stat-card timer" id="timer-card">
          <div class="stat-label">Time Left</div>
          <div id="timer" class="stat-value">0s</div>
        </div>
        <div class="stat-card best">
          <div class="stat-label">Best Streak</div>
          <div id="best-streak" class="stat-value">0</div>
        </div>
        <div class="stat-card" style="border-color: var(--accent-3); min-width: 140px;">
          <div class="stat-label">Your Skill</div>
          <div id="accuracy" class="stat-value" style="color: var(--accent-3); font-size: 16px;">--%</div>
        </div>
      </nav>
      <!-- Share Button -->
      <button id="share-btn" onclick="shareGame()" style="
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--accent);
        border: none;
        border-radius: 12px;
        padding: 8px 16px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        font-size: 14px;
        z-index: 10;
      ">ðŸ“¤ Share</button>
    </header>
    <div class="stat-card multiplier-card" style="display:none;">
      <div class="stat-label">Multiplier</div>
      <div id="multiplier" class="stat-value">x1</div>
    </div>
    

    <main>
      <section class="panel">
        <h2>Spot the Pattern</h2>
        <div class="sequence" id="sequence"></div>
        <div class="legend">Predict the 5th item in the sequence.</div>

        <h2 style="margin-top:18px;">Choose Your Prediction</h2>
        <div class="choices" id="choices"></div>
        <div class="tagline">Pick a shape + color combo. Higher streaks boost rewards!</div>
      </section>

      <section class="panel">
        <h2>Place Your Bet</h2>
        <div class="bets" id="bets"></div>
        <div class="bet-preview" id="bet-preview">Select a bet to see potential winnings.</div>

        <div class="message" id="message">
          <span>Make a prediction and place your bet to start.</span>
        </div>

        <div class="combo-indicator" id="combo-indicator">
          <div>
            <div class="combo-label">Combo Heat</div>
            <div class="combo-value" id="combo-value">x1</div>
          </div>
          <div class="combo-bar">
            <div class="combo-fill" id="combo-fill"></div>
          </div>
        </div>

        <div class="footer-controls">
          <button id="submit" class="btn primary" disabled>Lock In Guess</button>
          <button id="next" class="btn" style="display:none;">Next Round</button>
          <button id="double" class="btn toggle" style="display:none;">Double or Nothing</button>
          <button id="sound-toggle" class="btn toggle active">Sound On</button>
        </div>
      </section>
      <section class="panel leaderboard-panel">
        <h2>Leaderboard</h2>
        <div class="leaderboard-list">
          <div class="leaderboard-item">
            <span class="leaderboard-rank">#1</span>
            <span class="leaderboard-name">PlayerOne</span>
            <span class="leaderboard-score">1500 pts</span>
          </div>
          <div class="leaderboard-item">
            <span class="leaderboard-rank">#2</span>
            <span class="leaderboard-name">StreakMaster</span>
            <span class="leaderboard-score">1200 pts</span>
          </div>
          <div class="leaderboard-item">
            <span class="leaderboard-rank">#3</span>
            <span class="leaderboard-name">GamerGirl</span>
            <span class="leaderboard-score">900 pts</span>
          </div>
          <div class="leaderboard-item">
            <span class="leaderboard-rank">#4</span>
            <span class="leaderboard-name">PatternPro</span>
            <span class="leaderboard-score">750 pts</span>
          </div>
          <div class="leaderboard-item">
            <span class="leaderboard-rank">#5</span>
            <span class="leaderboard-name">LuckyGuess</span>
            <span class="leaderboard-score">600 pts</span>
          </div>
        </div>
      </section>
    </main>
    <div id="fx-layer"></div>
  </div>

  <canvas id="confetti"></canvas>
  <div class="gameover" id="gameover">
    <div class="gameover-card">
      <div class="gameover-title">Game Over</div>
      <div class="gameover-stats">
        <div class="gameover-stat">
          <label>Best Streak</label>
          <span id="gameover-best">0</span>
        </div>
        <div class="gameover-stat">
          <label>Rounds Played</label>
          <span id="gameover-rounds">0</span>
        </div>
        <div class="gameover-stat">
          <label>Total Points Earned</label>
          <span id="gameover-points">0</span>
        </div>
      </div>
      <button id="restart" class="btn primary">Restart</button>
    </div>
  </div>

  <script>
    const shapes = ["circle", "square", "triangle"];
    const colors = [
      { name: "red", value: "#ff4d6d" },
      { name: "blue", value: "#49d3ff" },
      { name: "green", value: "#7bff8f" },
      { name: "yellow", value: "#ffd65e" }
    ];

    const betOptions = [10, 25, 50, 100];
    const choiceCount = 4;
    const timeLimitSeconds = 10;
    const bestStreakKey = "streak-best";
    const totalRoundsKey = "streak-rounds";
    const totalPointsKey = "streak-total-points";
    const milestoneTargets = new Set([5, 10, 15]);
    const startingPoints = 200;
    let points = startingPoints;
    let streak = 0;
    let bestStreak = 0;
    let totalRounds = 0;
    let totalPointsEarned = 0;
    let correctGuesses = 0;
    const correctGuessesKey = "streak-correct";
    let recentResults = []; // Track last 10 results for trend
    const recentResultsKey = "streak-recent";
    let selectedBet = null;
    let selectedChoice = null;
    let answer = null;
    let roundLocked = false;
    let timerId = null;
    let timeoutId = null;
    let autoNextId = null;
    let autoNextCountdownId = null;
    let timeLeft = timeLimitSeconds;
    let audioContext = null;
    let audioReady = false;
    let soundEnabled = true;
    let doubleOrNothing = false;

    const pointsEl = document.getElementById("points");
    const streakEl = document.getElementById("streak");
    const bestStreakEl = document.getElementById("best-streak");
    const multiplierEl = document.getElementById("multiplier");
    const timerEl = document.getElementById("timer");
    const timerCard = document.getElementById("timer-card");
    const sequenceEl = document.getElementById("sequence");
    const choicesEl = document.getElementById("choices");
    const betsEl = document.getElementById("bets");
    const betPreviewEl = document.getElementById("bet-preview");
    const messageEl = document.getElementById("message");
    const submitBtn = document.getElementById("submit");
    const nextBtn = document.getElementById("next");
    const doubleBtn = document.getElementById("double");
    const soundToggleBtn = document.getElementById("sound-toggle");
    const gameEl = document.querySelector(".game");
    const bestCardEl = document.querySelector(".stat-card.best");
    const confettiCanvas = document.getElementById("confetti");
    const confettiCtx = confettiCanvas.getContext("2d");
    const fxLayer = document.getElementById("fx-layer");
    const comboIndicator = document.getElementById("combo-indicator");
    const comboValue = document.getElementById("combo-value");
    const comboFill = document.getElementById("combo-fill");
    const gameOverEl = document.getElementById("gameover");
    const gameOverBest = document.getElementById("gameover-best");
    const gameOverRounds = document.getElementById("gameover-rounds");
    const gameOverPoints = document.getElementById("gameover-points");
    const restartBtn = document.getElementById("restart");

    const allCombos = shapes.flatMap(shape => colors.map(color => ({ shape, color: color.name })));

    function ensureAudio() {
      if (!soundEnabled) return;
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioContext.state === "suspended") {
        audioContext.resume();
      }
      audioReady = true;
    }

    function playTone(frequency, duration, type = "sine", volume = 0.08) {
      if (!audioReady || !audioContext || !soundEnabled) return;
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.type = type;
      osc.frequency.value = frequency;
      gain.gain.value = volume;
      osc.connect(gain);
      gain.connect(audioContext.destination);
      const now = audioContext.currentTime;
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(volume, now + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);
      osc.start(now);
      osc.stop(now + duration + 0.02);
    }

    function playChord(frequencies, gap = 0.06) {
      frequencies.forEach((freq, idx) => {
        setTimeout(() => playTone(freq, 0.18, "triangle", 0.1), idx * gap * 1000);
      });
    }

    function createChoiceButton(shape, color, hintText) {
      const btn = document.createElement("button");
      btn.className = "btn";
      btn.dataset.shape = shape;
      btn.dataset.color = color.name;
      const shapeEl = document.createElement("div");
      shapeEl.className = `shape ${shape}`;
      if (shape === "triangle") {
        shapeEl.style.borderBottomColor = color.value;
      } else {
        shapeEl.style.color = color.value;
      }
      btn.appendChild(shapeEl);
      const label = document.createElement("span");
      label.textContent = color.name;
      btn.appendChild(label);
      const hint = document.createElement("span");
      hint.className = "hint";
      hint.textContent = hintText || "";
      btn.appendChild(hint);
      btn.addEventListener("click", () => {
        ensureAudio();
        playTone(520, 0.12, "triangle", 0.06);
        document.querySelectorAll(".choices .btn").forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedChoice = { shape, color: color.name };
        updateSubmitState();
      });
      return btn;
    }

    function createBetButton(value, hintText) {
      const btn = document.createElement("button");
      btn.className = "btn bet";
      btn.textContent = value;
      const hint = document.createElement("span");
      hint.className = "hint";
      hint.textContent = hintText || "";
      btn.appendChild(hint);
      btn.addEventListener("click", () => {
        ensureAudio();
        playTone(340, 0.1, "sine", 0.05);
        document.querySelectorAll(".bets .btn").forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedBet = value;
        updateBetPreview();
        updateSubmitState();
      });
      return btn;
    }

    function updateStats() {
      pointsEl.textContent = points;
      streakEl.textContent = streak;
      bestStreakEl.textContent = bestStreak;
      multiplierEl.textContent = `x${Math.max(1, streak)}`;
      comboValue.textContent = `x${Math.max(1, streak)}`;
      const comboBoost = Math.min(100, Math.max(0, streak - 1) * 18);
      comboFill.style.width = `${comboBoost}%`;
      comboIndicator.classList.toggle("hot", streak >= 4);
      comboValue.style.transform = `scale(${1 + Math.min(streak, 6) * 0.05})`;
    }

    function updateSubmitState() {
      submitBtn.disabled = roundLocked || !(selectedBet && selectedChoice);
    }

    function updateBetPreview() {
      if (!selectedBet) {
        betPreviewEl.textContent = "Select a bet to see potential winnings.";
        betPreviewEl.classList.remove("active");
        betPreviewEl.classList.remove("risky");
        return;
      }
      const baseReward = selectedBet * (streak + 1);
      const projected = doubleOrNothing ? baseReward * 2 : baseReward;
      const betPercentage = (selectedBet / points) * 100;
      const isRisky = betPercentage > 25;
      
      let previewText = doubleOrNothing
        ? `Double or Nothing: win +${projected} points, lose EVERYTHING`
        : `If correct: +${projected} points`;
      
      if (isRisky && !doubleOrNothing) {
        previewText += ` âš ï¸ High bet (${Math.round(betPercentage)}% of points)`;
        betPreviewEl.classList.add("risky");
      } else {
        betPreviewEl.classList.remove("risky");
      }
      
      betPreviewEl.textContent = previewText;
      betPreviewEl.classList.add("active");
    }

    function loadBestStreak() {
      const stored = parseInt(localStorage.getItem(bestStreakKey), 10);
      if (!Number.isNaN(stored)) {
        bestStreak = stored;
      }
    }

    function saveBestStreak() {
      localStorage.setItem(bestStreakKey, bestStreak);
    }

    function loadTotals() {
      const rounds = parseInt(localStorage.getItem(totalRoundsKey), 10);
      const total = parseInt(localStorage.getItem(totalPointsKey), 10);
      const correct = parseInt(localStorage.getItem(correctGuessesKey), 10);
      if (!Number.isNaN(rounds)) totalRounds = rounds;
      if (!Number.isNaN(total)) totalPointsEarned = total;
      if (!Number.isNaN(correct)) correctGuesses = correct;
      try {
        const recent = JSON.parse(localStorage.getItem(recentResultsKey) || "[]");
        if (Array.isArray(recent)) recentResults = recent.slice(-10);
      } catch(e) {}
      updateAccuracyDisplay();
    }

    function saveTotals() {
      localStorage.setItem(totalRoundsKey, totalRounds);
      localStorage.setItem(totalPointsKey, totalPointsEarned);
      localStorage.setItem(correctGuessesKey, correctGuesses);
      localStorage.setItem(recentResultsKey, JSON.stringify(recentResults.slice(-10)));
    }
    
    function updateAccuracyDisplay() {
      const accuracyEl = document.getElementById('accuracy');
      const avgAccuracy = 42; // Simulated global average
      if (accuracyEl && totalRounds > 0) {
        const pct = Math.round((correctGuesses / totalRounds) * 100);
        const diff = pct - avgAccuracy;
        const indicator = diff >= 0 ? 'â†‘' : 'â†“';
        const color = diff >= 0 ? 'var(--accent-3)' : 'var(--accent)';
        // Calculate trend from recent results
        const recentCorrect = recentResults.filter(r => r === 1).length;
        const trend = recentResults.length >= 5 ? (recentCorrect >= 3 ? 'ðŸ”¥' : recentCorrect <= 1 ? 'â„ï¸' : '') : '';
        accuracyEl.innerHTML = `${pct}% ${trend}<br><span style="font-size:11px;color:${color}">${indicator}${Math.abs(diff)}% vs avg</span>`;
      }
    }

    function clampPoints() {
      if (points < 0) points = 0;
    }

    function pick(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function shuffle(arr) {
      return arr.slice().sort(() => Math.random() - 0.5);
    }

    function renderChoices(choices) {
      choicesEl.innerHTML = "";
      const hints = ["1", "2", "3", "4"];
      choices.forEach((choice, index) => {
        const color = colors.find(c => c.name === choice.color);
        choicesEl.appendChild(createChoiceButton(choice.shape, color, hints[index]));
      });
    }

    function buildChoiceSet(correctAnswer) {
      const pool = allCombos.filter(
        combo => !(combo.shape === correctAnswer.shape && combo.color === correctAnswer.color)
      );
      const picked = shuffle(pool).slice(0, Math.max(0, choiceCount - 1));
      return shuffle([correctAnswer, ...picked]);
    }

    function setChoicesDisabled(disabled) {
      choicesEl.querySelectorAll("button").forEach(btn => {
        btn.disabled = disabled;
      });
    }

    function updateTimerDisplay() {
      timerEl.textContent = `${Math.max(0, timeLeft)}s`;
      if (timeLeft <= 3) {
        timerCard.classList.add("danger");
      } else {
        timerCard.classList.remove("danger");
      }
      if (timeLeft === 5) {
        sequenceEl.classList.add("pulse");
      }
      if (timeLeft > 5 || timeLeft <= 0) {
        sequenceEl.classList.remove("pulse");
      }
    }

    function clearTimer() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
      if (timeoutId) {
        clearTimeout(timeoutId);
        timeoutId = null;
      }
    }

    function startTimer() {
      clearTimer();
      timeLeft = timeLimitSeconds;
      updateTimerDisplay();
      timerId = setInterval(() => {
        timeLeft -= 1;
        updateTimerDisplay();
        if (timeLeft > 0 && timeLeft <= 3) {
          playTone(720, 0.08, "square", 0.04);
        }
        if (timeLeft <= 0) {
          clearTimer();
        }
      }, 1000);
      timeoutId = setTimeout(handleTimeout, timeLimitSeconds * 1000);
    }

    function generateSequence() {
      const hardChance = Math.random() < 0.4;
      const hardRule = Math.floor(Math.random() * 3);
      const easyRule = Math.floor(Math.random() * 5);
      let seq = [];
      if (!hardChance && easyRule === 0) {
        // Shape cycle of 3, fixed color
        const order = [...shapes].sort(() => Math.random() - 0.5);
        const color = pick(colors);
        for (let i = 0; i < 5; i++) {
          seq.push({ shape: order[i % 3], color: color.name });
        }
      } else if (!hardChance && easyRule === 1) {
        // Color cycle of 4, fixed shape
        const order = [...colors].sort(() => Math.random() - 0.5);
        const shape = pick(shapes);
        for (let i = 0; i < 5; i++) {
          seq.push({ shape, color: order[i % 4].name });
        }
      } else if (!hardChance && easyRule === 2) {
        // Alternate shapes, fixed color
        const pair = [...shapes].sort(() => Math.random() - 0.5).slice(0, 2);
        const color = pick(colors);
        for (let i = 0; i < 5; i++) {
          seq.push({ shape: pair[i % 2], color: color.name });
        }
      } else if (!hardChance && easyRule === 3) {
        // Alternate colors, fixed shape
        const pair = [...colors].sort(() => Math.random() - 0.5).slice(0, 2);
        const shape = pick(shapes);
        for (let i = 0; i < 5; i++) {
          seq.push({ shape, color: pair[i % 2].name });
        }
      } else if (!hardChance && easyRule === 4) {
        // Pair repeat
        const first = { shape: pick(shapes), color: pick(colors).name };
        let second = { shape: pick(shapes), color: pick(colors).name };
        if (second.shape === first.shape && second.color === first.color) {
          second = { shape: pick(shapes), color: pick(colors).name };
        }
        seq = [first, second, first, second, first];
      } else if (hardRule === 0) {
        // Hard mode: shape + color cycles together with offset
        const shapeOrder = shuffle(shapes);
        const colorOrder = shuffle(colors);
        const colorOffset = Math.floor(Math.random() * colorOrder.length);
        for (let i = 0; i < 5; i++) {
          const shape = shapeOrder[i % shapeOrder.length];
          const color = colorOrder[(i + colorOffset) % colorOrder.length].name;
          seq.push({ shape, color });
        }
      } else if (hardRule === 1) {
        // Hard mode: shape alternates, color cycles every 3
        const shapePair = shuffle(shapes).slice(0, 2);
        const colorOrder = shuffle(colors);
        for (let i = 0; i < 5; i++) {
          const shape = shapePair[i % 2];
          const color = colorOrder[i % 3].name;
          seq.push({ shape, color });
        }
      } else {
        // Hard mode: color mirrors while shape steps forward
        const shapeOrder = shuffle(shapes);
        const colorOrder = shuffle(colors).slice(0, 3);
        const mirror = [...colorOrder, colorOrder[1]];
        for (let i = 0; i < 5; i++) {
          const shape = shapeOrder[i % shapeOrder.length];
          const color = mirror[i % mirror.length].name;
          seq.push({ shape, color });
        }
      }
      return seq;
    }

    function renderSequence(seq) {
      sequenceEl.innerHTML = "";
      seq.slice(0, 4).forEach((item) => {
        const slot = document.createElement("div");
        slot.className = "slot";
        const shapeEl = document.createElement("div");
        shapeEl.className = `shape ${item.shape}`;
        if (item.shape === "triangle") {
          const color = colors.find(c => c.name === item.color);
          shapeEl.style.borderBottomColor = color.value;
        } else {
          shapeEl.style.color = colors.find(c => c.name === item.color).value;
        }
        slot.appendChild(shapeEl);
        sequenceEl.appendChild(slot);
      });

      const mystery = document.createElement("div");
      mystery.className = "slot mystery";
      const q = document.createElement("span");
      q.textContent = "?";
      mystery.appendChild(q);
      sequenceEl.appendChild(mystery);
    }

    function revealAnswer() {
      const slots = sequenceEl.querySelectorAll(".slot");
      const lastSlot = slots[slots.length - 1];
      if (!lastSlot) return;
      lastSlot.innerHTML = "";
      lastSlot.classList.remove("mystery");
      const shapeEl = document.createElement("div");
      shapeEl.className = `shape ${answer.shape}`;
      const color = colors.find(c => c.name === answer.color);
      if (answer.shape === "triangle") {
        shapeEl.style.borderBottomColor = color.value;
      } else {
        shapeEl.style.color = color.value;
      }
      lastSlot.appendChild(shapeEl);
    }

    function handleTimeout() {
      if (roundLocked) return;
      roundLocked = true;
      clearTimer();
      setChoicesDisabled(true);
      streak = 0;
      totalRounds += 1;
      saveTotals();
      if (selectedBet) {
        if (doubleOrNothing) {
          points = 0;
          messageEl.innerHTML = `<span><strong>Time's up!</strong> Double or nothing failed. Wiped out.</span>`;
        } else {
          const loss = Math.round(selectedBet * 1.15);
          points -= loss;
          clampPoints();
          messageEl.innerHTML = `<span><strong>Time's up!</strong> -${loss} points. Streak reset.</span>`;
        }
        triggerShake();
      } else {
        messageEl.innerHTML = `<span><strong>Time's up!</strong> No bet placed. Streak reset.</span>`;
      }
      messageEl.classList.remove("glow");
      updateStats();
      updateBetPreview();
      updateDoubleOrNothingState();
      submitBtn.disabled = true;
      showNextButton();
      scheduleAutoNext();
      revealAnswer();
      checkGameOver();
    }

    function resetRound() {
      selectedBet = null;
      selectedChoice = null;
      roundLocked = false;
      doubleOrNothing = false;
      submitBtn.disabled = true;
      hideNextButton();
      clearAutoNext();
      sequenceEl.classList.remove("pulse");
      document.querySelectorAll(".btn.selected").forEach(btn => btn.classList.remove("selected"));
      const seq = generateSequence();
      answer = seq[4];
      renderSequence(seq);
      renderChoices(buildChoiceSet(answer));
      setChoicesDisabled(false);
      messageEl.innerHTML = "<span>Make a prediction and place your bet before time runs out.</span>";
      messageEl.classList.remove("glow");
      updateBetPreview();
      updateDoubleOrNothingState();
      startTimer();
    }

    function launchConfetti() {
      const palette = colors.map(color => color.value);
      const pieces = Array.from({ length: 140 }, () => ({
        x: confettiCanvas.width * (0.2 + Math.random() * 0.6),
        y: confettiCanvas.height * 0.25,
        vx: (Math.random() - 0.5) * 6,
        vy: Math.random() * -6 - 4,
        size: 6 + Math.random() * 6,
        color: palette[Math.floor(Math.random() * palette.length)],
        rotation: Math.random() * Math.PI,
        spin: (Math.random() - 0.5) * 0.3
      }));
      const start = performance.now();
      const duration = 1200;

      function tick(now) {
        const elapsed = now - start;
        confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        pieces.forEach(p => {
          p.vy += 0.15;
          p.x += p.vx;
          p.y += p.vy;
          p.rotation += p.spin;
          confettiCtx.save();
          confettiCtx.translate(p.x, p.y);
          confettiCtx.rotate(p.rotation);
          confettiCtx.fillStyle = p.color;
          confettiCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size * 0.6);
          confettiCtx.restore();
        });
        if (elapsed < duration) {
          requestAnimationFrame(tick);
        } else {
          confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        }
      }
      requestAnimationFrame(tick);
    }

    function playWinEffects() {
      gameEl.classList.add("win");
      setTimeout(() => gameEl.classList.remove("win"), 600);
      launchConfetti();
    }

    function spawnFloatPoints(amount) {
      const gameRect = gameEl.getBoundingClientRect();
      const pointsRect = pointsEl.getBoundingClientRect();
      const bubble = document.createElement("div");
      bubble.className = "float-points";
      bubble.textContent = `+${amount}`;
      const left = pointsRect.left - gameRect.left + pointsRect.width / 2;
      const top = pointsRect.top - gameRect.top - 8;
      bubble.style.left = `${left}px`;
      bubble.style.top = `${top}px`;
      fxLayer.appendChild(bubble);
      setTimeout(() => bubble.remove(), 1400);
    }

    function spawnBanner(text, className) {
      const banner = document.createElement("div");
      banner.className = `banner-pop ${className}`;
      banner.textContent = text;
      fxLayer.appendChild(banner);
      setTimeout(() => banner.remove(), 1700);
    }

    function celebrateMilestone() {
      spawnBanner(`Streak ${streak}!`, "banner-milestone");
      playChord([660, 880, 990], 0.05);
      launchConfetti();
    }

    function celebrateNewBest() {
      spawnBanner("New Best Streak!", "banner-best");
      bestCardEl.classList.add("new-record");
      gameEl.classList.add("best-beat");
      setTimeout(() => {
        bestCardEl.classList.remove("new-record");
        gameEl.classList.remove("best-beat");
      }, 1300);
      playChord([520, 780, 1040], 0.06);
      launchConfetti();
    }

    function showNextButton() {
      nextBtn.style.display = "inline-flex";
      nextBtn.textContent = "Next Round";
      nextBtn.disabled = false;
    }

    function hideNextButton() {
      nextBtn.style.display = "none";
      nextBtn.textContent = "Next Round";
      nextBtn.disabled = false;
    }

    function clearAutoNext() {
      if (autoNextId) {
        clearTimeout(autoNextId);
        autoNextId = null;
      }
      if (autoNextCountdownId) {
        clearInterval(autoNextCountdownId);
        autoNextCountdownId = null;
      }
    }

    function scheduleAutoNext() {
      clearAutoNext();
      let countdown = 2;
      nextBtn.textContent = `Next (${countdown})`;
      autoNextCountdownId = setInterval(() => {
        countdown -= 1;
        if (countdown > 0) {
          nextBtn.textContent = `Next (${countdown})`;
        }
      }, 1000);
      autoNextId = setTimeout(() => {
        resetRound();
      }, 2000);
    }

    function resolveGuess() {
      if (!selectedBet || !selectedChoice || roundLocked) return;
      roundLocked = true;
      clearTimer();
      setChoicesDisabled(true);
      totalRounds += 1;

      if (selectedChoice.shape === answer.shape && selectedChoice.color === answer.color) {
        streak += 1;
        correctGuesses += 1;
        recentResults.push(1); // Track correct
        const baseReward = selectedBet * streak;
        const reward = doubleOrNothing ? baseReward * 2 : baseReward;
        points += reward;
        messageEl.innerHTML = `<span><strong>Correct!</strong> +${reward} points (x${streak})</span>`;
        messageEl.classList.add("glow");
        spawnFloatPoints(reward);
        totalPointsEarned += reward;
        saveTotals();
        updateAccuracyDisplay();
        playChord([520, 720, 980], 0.05);
        if (milestoneTargets.has(streak)) {
          celebrateMilestone();
        }
        if (streak > bestStreak) {
          bestStreak = streak;
          saveBestStreak();
          celebrateNewBest();
        }
        playWinEffects();
      } else {
        if (doubleOrNothing) {
          points = 0;
          messageEl.innerHTML = `<span><strong>Missed!</strong> Double or nothing failed. Wiped out.</span>`;
        } else {
          const lossScale = 1 + Math.min(streak, 4) * 0.15;
          const loss = Math.round(selectedBet * lossScale);
          points -= loss;
          clampPoints();
          messageEl.innerHTML = `<span><strong>Missed!</strong> -${loss} points. Streak reset.</span>`;
        }
        recentResults.push(0); // Track wrong
        streak = 0;
        messageEl.classList.remove("glow");
        playTone(180, 0.25, "sawtooth", 0.08);
        triggerShake();
      }

      saveTotals();
      updateAccuracyDisplay();
      updateStats();
      updateBetPreview();
      updateDoubleOrNothingState();
      submitBtn.disabled = true;
      showNextButton();
      scheduleAutoNext();
      revealAnswer();
      checkGameOver();
    }

    function updateDoubleOrNothingState() {
      const eligible = streak >= 3 && !roundLocked;
      doubleBtn.style.display = eligible ? "inline-flex" : "none";
      doubleBtn.classList.toggle("active", doubleOrNothing);
    }

    function triggerShake() {
      gameEl.classList.add("shake");
      setTimeout(() => gameEl.classList.remove("shake"), 450);
    }

    function checkGameOver() {
      if (points > 0) return;
      clearTimer();
      clearAutoNext();
      roundLocked = true;
      setChoicesDisabled(true);
      submitBtn.disabled = true;
      nextBtn.disabled = true;
      gameOverBest.textContent = bestStreak;
      gameOverRounds.textContent = totalRounds;
      gameOverPoints.textContent = totalPointsEarned;
      gameOverEl.classList.add("active");
    }

    function restartGame() {
      points = startingPoints;
      streak = 0;
      selectedBet = null;
      selectedChoice = null;
      doubleOrNothing = false;
      gameOverEl.classList.remove("active");
      updateStats();
      updateBetPreview();
      updateDoubleOrNothingState();
      resetRound();
    }

    function init() {
      // Handle instructions overlay
      const instructionsOverlay = document.getElementById("instructions-overlay");
      const startGameBtn = document.getElementById("start-game-btn");
      if (startGameBtn && instructionsOverlay) {
        startGameBtn.addEventListener("click", () => {
          ensureAudio();
          instructionsOverlay.classList.add("hidden");
          resetRound();
        });
      }

      const betHints = ["Q", "W", "E", "R"];
      betOptions.forEach((value, index) => betsEl.appendChild(createBetButton(value, betHints[index])));

      const resizeConfetti = () => {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      };
      window.addEventListener("resize", resizeConfetti);
      resizeConfetti();
      loadBestStreak();
      loadTotals();

      submitBtn.addEventListener("click", resolveGuess);
      nextBtn.addEventListener("click", () => {
        clearAutoNext();
        resetRound();
      });
      doubleBtn.addEventListener("click", () => {
        ensureAudio();
        doubleOrNothing = !doubleOrNothing;
        doubleBtn.classList.toggle("active", doubleOrNothing);
        updateBetPreview();
        playTone(doubleOrNothing ? 860 : 360, 0.12, "triangle", 0.06);
      });
      soundToggleBtn.addEventListener("click", () => {
        soundEnabled = !soundEnabled;
        soundToggleBtn.textContent = soundEnabled ? "Sound On" : "Sound Off";
        soundToggleBtn.classList.toggle("active", soundEnabled);
        if (soundEnabled) {
          ensureAudio();
          playTone(620, 0.1, "triangle", 0.06);
        }
      });
      restartBtn.addEventListener("click", restartGame);

      document.addEventListener("keydown", (event) => {
        if (event.repeat) return;
        const key = event.key.toLowerCase();
        if (["1", "2", "3", "4"].includes(key)) {
          ensureAudio();
          const index = Number(key) - 1;
          const choiceBtn = choicesEl.querySelectorAll("button")[index];
          if (choiceBtn && !choiceBtn.disabled) {
            choiceBtn.click();
          }
          return;
        }
        if (["q", "w", "e", "r"].includes(key)) {
          ensureAudio();
          const index = ["q", "w", "e", "r"].indexOf(key);
          const betBtn = betsEl.querySelectorAll("button")[index];
          if (betBtn && !betBtn.disabled) {
            betBtn.click();
          }
          return;
        }
        if (key === " ") {
          event.preventDefault();
          ensureAudio();
          if (!submitBtn.disabled) {
            playTone(620, 0.1, "triangle", 0.07);
            resolveGuess();
          }
          return;
        }
        if (key === "d") {
          if (doubleBtn.style.display !== "none") {
            doubleBtn.click();
          }
          return;
        }
      });

      updateStats();
      updateBetPreview();
      resetRound();
    }

    init();
  </script>
</body>
</html>
<script>
  // Register Service Worker for PWA
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log('SW registered'))
      .catch(err => console.log('SW failed:', err));
  }

  // Share function
  async function shareGame() {
    const shareData = {
      title: 'STREAK - Pattern Prediction',
      text: `I just hit a ${document.getElementById('best-streak').textContent} streak in STREAK! Can you beat me? ðŸ”¥`,
      url: window.location.href
    };
    
    try {
      if (navigator.share) {
        await navigator.share(shareData);
      } else {
        // Fallback: copy to clipboard
        await navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`);
        alert('Link copied to clipboard!');
      }
    } catch (err) {
      console.log('Share failed:', err);
    }
  }

  // Simple analytics (localStorage)
  const analytics = JSON.parse(localStorage.getItem('streak_analytics') || '{}');
  analytics.visits = (analytics.visits || 0) + 1;
  analytics.lastVisit = new Date().toISOString();
  localStorage.setItem('streak_analytics', JSON.stringify(analytics));
</script>
